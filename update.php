<?php

/**
 * Update von Version 2.0.2 auf 2.0.3
 *
 * @author     Oliver Kleditzsch
 * @copyright  Copyright (c) 2014, Oliver Kleditzsch
 * @license    http://opensource.org/licenses/gpl-license.php GNU Public License
 * @since      2.0.3-0
 * @version    2.0.3-0
 */

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Update v2.0.0-2 auf v2.0.3 //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//Datenupdate Ereignisse
if(file_exists(__DIR__ .'/shc/data/storage/events.xml')) {

    $xml = new SimpleXMLElement(__DIR__ .'/shc/data/storage/events.xml', null, true);

    foreach($xml->event as $event) {

        if(!isset($event->lastExecute)) {

            $event->addChild('lastExecute', '2000-01-01 00:00:00');
        }
    }

    $xml->asXML(__DIR__ .'/shc/data/storage/events.xml');
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Update v2.0.3 auf v2.2.0 //////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
$content = file_get_contents('./shc/app.php');
str_replace('"installed": false', '"installed": true', $content);
file_put_contents('./shc/app.php', $content);

print("Update erfolgreich\n");

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// sich selbst loeschen ////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

@unlink(__FILE__);